; ------------------------------------------------------------------------
; Compiled by MSX-BACON from test.asc
; ------------------------------------------------------------------------
; 
bios_chgmod                     equ 0005Fh
bios_fout                       equ 03425h
work_dac_int                    equ 0F7F8h
work_valtyp                     equ 0F663h
work_dac                        equ 0F7F6h
bios_imult                      equ 03193h
; BSAVE header -----------------------------------------------------------
        DEFB        0FEh
        DEFW        start_address
        DEFW        end_address
        DEFW        start_address
        ORG         08010h
start_address:
        LD          (save_stack), SP
        LD          DE, program_start
        JP          program_run
program_start:
        LD          HL, 1
        LD          A, L
        CALL        bios_chgmod
        LD          HL, str_0
        PUSH        HL
        CALL        puts
        POP         HL
        CALL        free_string
        LD          HL, str_1
        CALL        puts
        LD          HL, str_2
        PUSH        HL
        CALL        puts
        POP         HL
        CALL        free_string
        LD          HL, str_3
        CALL        puts
        LD          HL, str_4
        PUSH        HL
        CALL        puts
        POP         HL
        CALL        free_string
        LD          HL, 12345
        LD          (work_dac_int), HL
        LD          A, 2
        LD          (work_valtyp), A
        CALL        str
        CALL        puts
        LD          HL, str_5
        CALL        puts
        LD          HL, str_6
        PUSH        HL
        CALL        puts
        POP         HL
        CALL        free_string
        LD          HL, const_41123456
        CALL        ld_dac_single_real
        CALL        str
        CALL        puts
        LD          HL, str_7
        CALL        puts
        LD          HL, str_8
        PUSH        HL
        CALL        puts
        POP         HL
        CALL        free_string
        LD          HL, const_42120000
        CALL        ld_dac_single_real
        CALL        str
        CALL        puts
        LD          HL, str_9
        CALL        puts
        LD          HL, str_10
        PUSH        HL
        CALL        puts
        POP         HL
        CALL        free_string
        LD          HL, const_40120000
        CALL        ld_dac_single_real
        CALL        str
        CALL        puts
        LD          HL, str_11
        CALL        puts
        LD          HL, str_12
        PUSH        HL
        CALL        puts
        POP         HL
        CALL        free_string
        LD          HL, const_42230000
        CALL        ld_dac_single_real
        CALL        str
        CALL        puts
        LD          HL, str_13
        CALL        puts
        LD          HL, str_14
        PUSH        HL
        CALL        puts
        POP         HL
        CALL        free_string
        LD          HL, const_4112345678901234
        CALL        ld_dac_double_real
        CALL        str
        CALL        puts
        LD          HL, str_15
        CALL        puts
        LD          HL, str_16
        PUSH        HL
        CALL        puts
        POP         HL
        CALL        free_string
        LD          HL, const_4212345678901234
        CALL        ld_dac_double_real
        CALL        str
        CALL        puts
        LD          HL, str_17
        CALL        puts
        LD          HL, str_18
        PUSH        HL
        CALL        puts
        POP         HL
        CALL        free_string
        LD          HL, const_4012345678901234
        CALL        ld_dac_double_real
        CALL        str
        CALL        puts
        LD          HL, str_19
        CALL        puts
        LD          HL, str_20
        PUSH        HL
        CALL        puts
        POP         HL
        CALL        free_string
        LD          HL, const_4312345678901234
        CALL        ld_dac_double_real
        CALL        str
        CALL        puts
        LD          HL, str_21
        CALL        puts
        LD          HL, str_22
        PUSH        HL
        CALL        puts
        POP         HL
        CALL        free_string
        LD          HL, str_23
        PUSH        HL
        CALL        puts
        POP         HL
        CALL        free_string
        LD          HL, str_24
        CALL        puts
        LD          HL, str_25
        PUSH        HL
        CALL        puts
        POP         HL
        CALL        free_string
        LD          HL, str_26
        PUSH        HL
        CALL        puts
        POP         HL
        CALL        free_string
        LD          HL, str_27
        CALL        puts
        LD          HL, str_28
        PUSH        HL
        CALL        puts
        POP         HL
        CALL        free_string
        LD          HL, 123
        LD          (work_dac_int), HL
        LD          A, 2
        LD          (work_valtyp), A
        CALL        str
        PUSH        HL
        CALL        puts
        POP         HL
        CALL        free_string
        LD          HL, str_29
        CALL        puts
        LD          HL, str_30
        PUSH        HL
        CALL        puts
        POP         HL
        CALL        free_string
        LD          HL, 123
        PUSH        HL
        LD          HL, 345
        PUSH        HL
        LD          HL, 2
        POP         DE
        CALL        bios_imult
        POP         DE
        ADD         HL, DE
        PUSH        HL
        LD          HL, 1
        POP         DE
        EX          DE, HL
        OR          A
        SBC         HL, DE
        LD          (work_dac_int), HL
        LD          A, 2
        LD          (work_valtyp), A
        CALL        str
        PUSH        HL
        CALL        puts
        POP         HL
        CALL        free_string
        LD          HL, str_31
        CALL        puts
        LD          HL, str_32
        PUSH        HL
        CALL        puts
        POP         HL
        CALL        free_string
        LD          HL, 1
        PUSH        HL
        LD          HL, 2
        POP         DE
        ADD         HL, DE
        PUSH        HL
        LD          HL, 3
        POP         DE
        ADD         HL, DE
        LD          (work_dac_int), HL
        LD          A, 2
        LD          (work_valtyp), A
        CALL        str
        CALL        puts
        LD          HL, str_33
        PUSH        HL
        CALL        puts
        POP         HL
        CALL        free_string
        LD          HL, str_34
        CALL        puts
        LD          HL, str_35
        PUSH        HL
        CALL        puts
        POP         HL
        CALL        free_string
        LD          HL, 10
        CALL        spc
        LD          HL, str_36
        PUSH        HL
        CALL        puts
        POP         HL
        CALL        free_string
        LD          HL, str_37
        CALL        puts
program_termination:
        LD          SP, (save_stack)
        RET
program_run:
        LD          HL, heap_start
        LD          (heap_next), HL
        LD          HL, (save_stack)
        LD          SP, HL
        PUSH        DE
        LD          DE, 256
        XOR         A
        SBC         HL, DE
        LD          (heap_end), HL
        RET
puts:
        LD          B, (HL)
_puts_loop:
        INC         HL
        LD          A, (HL)
        RST         018h
        DJNZ        _puts_loop
        RET
free_string:
        PUSH        HL
        LD          E, (HL)
        LD          D, 0
        ADD         HL, DE
        INC         HL
        INC         DE
        SBC         HL, DE
        POP         HL
        RET
        LD          (heap_next), HL
        RET
str:
        CALL        bios_fout
        PUSH        HL
        XOR         A
        LD          B, A
_str_loop:
        INC         HL
        CP          (HL)
        JR          Z, _str_loop_exit
        INC         B
        JR          _str_loop
_str_loop_exit:
        POP         HL
        LD          (HL), B
        RET
ld_dac_single_real:
        LD          DE, work_dac
        LD          BC, 4
        LDIR
        LD          (work_dac+4), BC
        LD          (work_dac+6), BC
        RET
ld_dac_double_real:
        LD          DE, work_dac
        LD          BC, 8
        LDIR
        LD          A, 8
        LD          (work_valtyp), A
        RET
spc:
        LD          B, L
        LD          A, 32
_spc_loop:
        INC         HL
        RST         018h
        DJNZ        _spc_loop
        RET
const_40120000:
        DEFB        040h, 012h, 000h, 000h
const_41123456:
        DEFB        041h, 012h, 034h, 056h
const_42120000:
        DEFB        042h, 012h, 000h, 000h
const_42230000:
        DEFB        042h, 023h, 000h, 000h
const_4012345678901234:
        DEFB        040h, 012h, 034h, 056h, 078h, 0FFFFFF90h, 012h, 034h
const_4112345678901234:
        DEFB        041h, 012h, 034h, 056h, 078h, 0FFFFFF90h, 012h, 034h
const_4212345678901234:
        DEFB        042h, 012h, 034h, 056h, 078h, 0FFFFFF90h, 012h, 034h
const_4312345678901234:
        DEFB        043h, 012h, 034h, 056h, 078h, 0FFFFFF90h, 012h, 034h
str_0:
        DEFB        00Dh, 048h, 045h, 04Ch, 04Ch, 04Fh, 02Ch, 020h, 057h, 04Fh, 052h, 04Ch, 044h, 021h
str_1:
        DEFB        002h, 00Dh, 00Ah
str_10:
        DEFB        00Ah, 053h, 049h, 04Eh, 047h, 04Ch, 045h, 020h, 020h, 03Dh, 020h
str_11:
        DEFB        002h, 00Dh, 00Ah
str_12:
        DEFB        00Ah, 053h, 049h, 04Eh, 047h, 04Ch, 045h, 020h, 020h, 03Dh, 020h
str_13:
        DEFB        002h, 00Dh, 00Ah
str_14:
        DEFB        00Ah, 044h, 04Fh, 055h, 042h, 04Ch, 045h, 020h, 020h, 03Dh, 020h
str_15:
        DEFB        002h, 00Dh, 00Ah
str_16:
        DEFB        00Ah, 044h, 04Fh, 055h, 042h, 04Ch, 045h, 020h, 020h, 03Dh, 020h
str_17:
        DEFB        002h, 00Dh, 00Ah
str_18:
        DEFB        00Ah, 044h, 04Fh, 055h, 042h, 04Ch, 045h, 020h, 020h, 03Dh, 020h
str_19:
        DEFB        002h, 00Dh, 00Ah
str_2:
        DEFB        013h, 054h, 068h, 069h, 073h, 020h, 069h, 073h, 020h, 04Dh, 053h, 058h, 02Dh, 042h, 041h, 043h, 04Fh, 04Eh, 021h, 021h
str_20:
        DEFB        00Ah, 044h, 04Fh, 055h, 042h, 04Ch, 045h, 020h, 020h, 03Dh, 020h
str_21:
        DEFB        002h, 00Dh, 00Ah
str_22:
        DEFB        00Ah, 053h, 054h, 052h, 049h, 04Eh, 047h, 020h, 020h, 03Dh, 020h
str_23:
        DEFB        00Bh, 04Dh, 06Fh, 06Ah, 069h, 04Dh, 06Fh, 06Ah, 069h, 04Bh, 075h, 06Eh
str_24:
        DEFB        002h, 00Dh, 00Ah
str_25:
        DEFB        00Ah, 053h, 054h, 052h, 049h, 04Eh, 047h, 020h, 020h, 03Dh, 020h
str_26:
        DEFB        00Ch, 04Bh, 061h, 069h, 067h, 079h, 06Fh, 02Dh, 04Eh, 061h, 073h, 068h, 069h
str_27:
        DEFB        002h, 00Dh, 00Ah
str_28:
        DEFB        00Ah, 053h, 054h, 052h, 049h, 04Eh, 047h, 020h, 020h, 03Dh, 020h
str_29:
        DEFB        002h, 00Dh, 00Ah
str_3:
        DEFB        002h, 00Dh, 00Ah
str_30:
        DEFB        00Ah, 053h, 054h, 052h, 049h, 04Eh, 047h, 020h, 020h, 03Dh, 020h
str_31:
        DEFB        002h, 00Dh, 00Ah
str_32:
        DEFB        00Ch, 049h, 04Eh, 054h, 045h, 047h, 045h, 052h, 020h, 03Dh, 020h, 03Ch, 03Ch
str_33:
        DEFB        002h, 03Eh, 03Eh
str_34:
        DEFB        002h, 00Dh, 00Ah
str_35:
        DEFB        001h, 05Bh
str_36:
        DEFB        001h, 05Dh
str_37:
        DEFB        002h, 00Dh, 00Ah
str_4:
        DEFB        00Ah, 049h, 04Eh, 054h, 045h, 047h, 045h, 052h, 020h, 03Dh, 020h
str_5:
        DEFB        002h, 00Dh, 00Ah
str_6:
        DEFB        00Ah, 053h, 049h, 04Eh, 047h, 04Ch, 045h, 020h, 020h, 03Dh, 020h
str_7:
        DEFB        002h, 00Dh, 00Ah
str_8:
        DEFB        00Ah, 053h, 049h, 04Eh, 047h, 04Ch, 045h, 020h, 020h, 03Dh, 020h
str_9:
        DEFB        002h, 00Dh, 00Ah
save_stack:
        DEFW        0
heap_next:
        DEFW        0
heap_end:
        DEFW        0
heap_start:
end_address:
